angular.module("jbm.angular-blog",["ui.router"]).config(["$stateProvider",function($stateProvider){$stateProvider.state("main.blog",{controller:"BlogCtrl",url:"/blog",templateUrl:"client/views/layout.html","abstract":!0}).state("main.blog.index",{controller:"BlogIndexCtrl",templateUrl:"client/views/index.html",url:"",ncyBreadcrumb:{parent:"main.homepage",label:"Blog"}}).state("main.blog.by_tag",{controller:"BlogTagCtrl",templateUrl:"client/views/index.html",url:"/tag/:tag",ncyBreadcrumb:{parent:"main.blog.index",label:"{{tag}}"}}).state("main.blog.show_post",{controller:"BlogShowCtrl",templateUrl:"client/views/show.html",url:"/:slug",ncyBreadcrumb:{parent:"main.blog.index",label:"{{post.title}}"}})}]),angular.module("jbm.angular-blog").controller("BlogCtrl",function($scope,$http,$state){$http({method:"GET",url:'/api/posts?filter={"order":"created_at DESC", "limit":5}'}).then(function(response){$scope.latest_posts=response.data},function(response){}),$http({method:"GET",url:"/api/posts/distinct_tags"}).then(function(response){var tags=response.data;for(var t in tags)tags[t].link=$state.href("main.blog.by_tag",{tag:tags[t].text});$("#tags-container").jQCloud(tags)},function(response){})}).controller("BlogIndexCtrl",function($scope,RemoteISPosts,$http){$scope.remoteIS=new RemoteISPosts("/api/posts",10,"created_at DESC")}).controller("BlogTagCtrl",function($scope,RemoteISPosts,$http,$stateParams){$scope.tag=$stateParams.tag,$scope.remoteIS=new RemoteISPosts("/api/posts",10,"created_at DESC",{where:{"tags.value":$stateParams.tag}})}).controller("BlogShowCtrl",function($stateParams,$scope,$http){$scope.post=null,$http({method:"GET",url:'/api/posts/findOne?filter={"where":{"slug":"'+$stateParams.slug+'"}}'}).then(function(response){$scope.post=response.data},function(response){})}),angular.module("jbm.angular-blog").directive("jbmBlogPosts",["$http",function($http){return{restrict:"E",scope:{posts:"="},transclude:!0,templateUrl:function(element,attrs){return"undefined"==typeof attrs.templateUrl?"client/views/partials/posts.html":attrs.templateUrl}}}]).directive("jbmBlogPost",["$http",function(){return{restrict:"E",scope:{post:"="},transclude:!0,templateUrl:function(element,attrs){return"undefined"==typeof attrs.templateUrl?"client/views/partials/post.html":attrs.templateUrl}}}]).directive("jbmBlogPostSm",["$http",function(){return{restrict:"E",scope:{post:"="},transclude:!0,templateUrl:function(element,attrs){return"undefined"==typeof attrs.templateUrl?"client/views/partials/post-small.html":attrs.templateUrl}}}]),angular.module("jbm.angular-blog").factory("RemoteISPosts",function(Analytics,$http){var RemoteIS=function(endpoint,limit,sort,filter){this.items=[],this.busy=!1,this.end=!1,this.filter=filter||{},this.limit=limit,this.filter.limit=limit,this.filter.skip=0,this.filter.order=sort,this.sort=sort,this.endpoint=endpoint};return RemoteIS.prototype.nextPage=function(){this.busy||this.end||(this.busy=!0,$http({method:"GET",url:this.endpoint+"?filter="+JSON.stringify(this.filter)}).then(function(results){if(0!==results.data.length){for(var i=0;i<results.data.length;i++)this.items.push(results.data[i]);this.filter.skip+=this.limit}else this.end=!0;this.busy=!1}.bind(this)))},RemoteIS});;angular.module('jbm.angular-blog').run(['$templateCache', function($templateCache) {
  'use strict';

  $templateCache.put('client/views/index.html',
    "<h1>Blog <span ng-if='tag'>- {{tag}}</span></h1>\n" +
    "\n" +
    "<div infinite-scroll='remoteIS.nextPage()' infinite-scroll-disabled='remoteIS.busy' infinite-scroll-distance='1' >\n" +
    "  <div ng-repeat=\"post in remoteIS.items track by $index\">\n" +
    "    <jbm-blog-post-sm post='post'></jbm-blog-post-sm>\n" +
    "    <div class=\"clearfix margin-bottom-20\"><hr></div>\n" +
    "  </div>\n" +
    "  <div style='clear: both;'></div>\n" +
    "  <div class='alert alert-info text-center' ng-show='remoteIS.busy'>Chargement des données...</div>\n" +
    "</div>\n"
  );


  $templateCache.put('client/views/layout.html',
    "<div ncy-breadcrumb></div>\n" +
    "<div class=\"row blog\">\n" +
    "  <div class=\"col-md-9\">\n" +
    "    <div ui-view></div>\n" +
    "  </div>\n" +
    "  <div class=\"col-md-3\">\n" +
    "    <h3 class=\"side-heading\" >Tags</h3>\n" +
    "    <div id='tags-container'></div>\n" +
    "  \t<h3 class=\"side-heading\" >Derniers articles</h3>\n" +
    "  \t<div class=\"list-group\" >\n" +
    "      <ul class=\"list-unstyled blog-latest-posts margin-bottom-50\">\n" +
    "        <li ng-repeat='post in latest_posts track by $index'>\n" +
    "          <h3><a ui-sref='main.blog.show_post({slug:post.slug})'>{{post.title}}</a></h3>\n" +
    "          <small>Posté le {{post.created_at | date : 'd MMM y'}}</small>\n" +
    "        </li>\n" +
    "      </ul>\n" +
    "  \t</div>\n" +
    "  </div>\n" +
    "</div>\n"
  );


  $templateCache.put('client/views/partials/post-small.html',
    "<div class=\"row margin-bottom-20\">\n" +
    "    <div class=\"col-sm-5 sm-margin-bottom-20\">\n" +
    "      <gridfs-img src='post.image.thumb' ng-title=\"post.title\" class=\"img-responsive\"></gridfs-img>\n" +
    "    </div>\n" +
    "    <div class=\"col-sm-7 news-v3\">\n" +
    "        <div class=\"news-v3-in-sm no-padding\">\n" +
    "            <ul class=\"list-inline posted-info\">\n" +
    "                <!-- <li>In <a href=\"#\">Design</a></li> -->\n" +
    "                <li>Posté le {{post.created_at | date : 'd MMM y'}}</li>\n" +
    "            </ul>\n" +
    "            <h2><a ui-sref='main.blog.show_post({slug:post.slug})'>{{post.title}}</a></h2>\n" +
    "            <p>{{post.description}}</p>\n" +
    "            <!-- <ul class=\"post-shares\">\n" +
    "                <li>\n" +
    "                    <a href=\"#\">\n" +
    "                        <i class=\"rounded-x icon-speech\"></i>\n" +
    "                        <span>5</span>\n" +
    "                    </a>\n" +
    "                </li>\n" +
    "                <li><a href=\"#\"><i class=\"rounded-x icon-share\"></i></a></li>\n" +
    "                <li><a href=\"#\"><i class=\"rounded-x icon-heart\"></i></a></li>\n" +
    "            </ul> -->\n" +
    "        </div>\n" +
    "    </div>\n" +
    "</div><!--/end row-->\n"
  );


  $templateCache.put('client/views/partials/post.html',
    "<div class=\"news-v3 margin-bottom-30\">\n" +
    "  <gridfs-img src='post.image.normal' ng-title=\"post.title\" class=\"img-responsive full-widt\"></gridfs-img>\n" +
    "  <div class=\"news-v3-in\">\n" +
    "    <ul class=\"list-inline posted-info\">\n" +
    "      <!-- <li>In <a href=\"#\">Design</a></li> -->\n" +
    "      <li>Posté le {{post.created_at | date : 'd MMM y'}}</li>\n" +
    "    </ul>\n" +
    "    <h2><a ui-sref='main.blog.show_post({slug:post.slug})'>{{post.title}}</a></h2>\n" +
    "    <p ng-bind-html=\"post.content\"></p>\n" +
    "\n" +
    "  </div>\n" +
    "</div>\n"
  );


  $templateCache.put('client/views/partials/posts.html',
    "<div ng-repeat='post in posts track by $index'>\n" +
    "  <jbm-blog-post-sm post='post'></jbm-blog-post-sm>\n" +
    "  <div class=\"clearfix margin-bottom-20\"><hr></div>\n" +
    "\n" +
    "</div>\n"
  );


  $templateCache.put('client/views/show.html',
    "<jbm-blog-post post='post'></jbm-blog-post>\n"
  );

}]);
